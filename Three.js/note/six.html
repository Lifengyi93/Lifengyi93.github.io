<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>导入外部3D模型 | Pattonli的博客</title>
    <meta name="description" content="Pattonli的博客">
    <link rel="icon" href="/img/hero.png">
  <link rel="stylesheet" href="/css/style.css">
    
    <link rel="preload" href="/assets/css/0.styles.40211726.css" as="style"><link rel="preload" href="/assets/js/app.f5aa86f6.js" as="script"><link rel="preload" href="/assets/js/2.029d9bf8.js" as="script"><link rel="preload" href="/assets/js/3.4c43594d.js" as="script"><link rel="prefetch" href="/assets/js/10.98bf705c.js"><link rel="prefetch" href="/assets/js/11.f05bc9d1.js"><link rel="prefetch" href="/assets/js/12.29288dc3.js"><link rel="prefetch" href="/assets/js/13.4adc37cb.js"><link rel="prefetch" href="/assets/js/14.09a4ecd0.js"><link rel="prefetch" href="/assets/js/15.83de2e43.js"><link rel="prefetch" href="/assets/js/16.2222bde7.js"><link rel="prefetch" href="/assets/js/17.03d33332.js"><link rel="prefetch" href="/assets/js/18.6710604b.js"><link rel="prefetch" href="/assets/js/19.44163cc7.js"><link rel="prefetch" href="/assets/js/20.7d23c089.js"><link rel="prefetch" href="/assets/js/21.f799e3f3.js"><link rel="prefetch" href="/assets/js/22.328a7a52.js"><link rel="prefetch" href="/assets/js/23.7e169318.js"><link rel="prefetch" href="/assets/js/24.317276df.js"><link rel="prefetch" href="/assets/js/4.8522cc0b.js"><link rel="prefetch" href="/assets/js/5.f2a83a19.js"><link rel="prefetch" href="/assets/js/6.2e7fb4ba.js"><link rel="prefetch" href="/assets/js/7.4f6134f5.js"><link rel="prefetch" href="/assets/js/8.a3e15926.js"><link rel="prefetch" href="/assets/js/9.8e81355b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.40211726.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Pattonli的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">博客指南</a></div><div class="nav-item"><a href="/Three.js/" class="nav-link router-link-active">Three.js</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端开发</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/html/" class="nav-link">Html</a></li><li class="dropdown-item"><!----> <a href="/web/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/web/javascript/" class="nav-link">javaScript</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工具箱</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>在线编辑</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://tinypng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图片压缩
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4>在线服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.aliyun.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阿里云
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://cloud.tencent.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  腾讯云
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/about.html" class="nav-link">关于</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">博客指南</a></div><div class="nav-item"><a href="/Three.js/" class="nav-link router-link-active">Three.js</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端开发</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/html/" class="nav-link">Html</a></li><li class="dropdown-item"><!----> <a href="/web/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/web/javascript/" class="nav-link">javaScript</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工具箱</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>在线编辑</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://tinypng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图片压缩
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li><li class="dropdown-item"><h4>在线服务</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.aliyun.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  阿里云
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://cloud.tencent.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  腾讯云
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/about.html" class="nav-link">关于</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>引入和安装</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>创建3D场景并渲染模型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>3D场景交互</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>导入外部3D模型</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Three.js/note/six.html" class="active sidebar-link">导入外部3D模型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Three.js/note/six.html#导入obj" class="sidebar-link">导入obj</a></li><li class="sidebar-sub-header"><a href="/Three.js/note/six.html#导入obj和mtl" class="sidebar-link">导入obj和mtl</a></li><li class="sidebar-sub-header"><a href="/Three.js/note/six.html#模型加载优化" class="sidebar-link">模型加载优化</a></li><li class="sidebar-sub-header"><a href="/Three.js/note/six.html#加载gltf-glb模型" class="sidebar-link">加载gltf/glb模型</a></li><li class="sidebar-sub-header"><a href="/Three.js/note/six.html#skybox" class="sidebar-link">skybox</a></li><li class="sidebar-sub-header"><a href="/Three.js/note/six.html#场景优化" class="sidebar-link">场景优化</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue项目中的3D模型显示与交互</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="导入外部3d模型"><a href="#导入外部3d模型" aria-hidden="true" class="header-anchor">#</a> 导入外部3D模型</h1> <p>three.js有一系列导入外部3D格式文件的库函数，我们可以在<a href="https://github.com/mrdoob/three.js/tree/master/examples/js/loaders" title="Three.js Loader" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>看到three.js目前支持的模型格式，在使用之前需要额外下载引入。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>js/OBJLoader.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>js/MTLLoader.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这两个文件当然是用来加载 .obj和.mtl格式文件的，先不用管怎么使用，先看看在《THREE.JS开发指南》2015年第一印第一版中提及的支持的主要3D格式文件:</p> <p><img src="/assets/img/gs.34ffb4b7.png" alt="three.js中主要的外部文件格式"></p> <p>关于这些格式模型的制作和导出在本书中并没有进行介绍，在另一方面，随着3D技术的发展，一些更友好的文件格式也在不断涌现，gltf就是其中的佼佼者。
我们可以在这里<a href="https://github.com/KhronosGroup/glTF" title="gltf" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>查看gltf官方的描述：</p> <div class="tip custom-block"><p>glTF™ (GL Transmission Format) is a royalty-free specification for the efficient transmission and loading of 3D scenes and models by applications. glTF minimizes both the size of 3D assets, and the runtime processing needed to unpack and use those assets. glTF defines an extensible, common publishing format for 3D content tools and services that streamlines authoring workflows and enables interoperable use of content across the industry.</p></div> <p>可以看出glTF可以有效地传输和加载3D场景和模型并且最小化了3D资源的大小。glTF 3D模型格式有两种： .gltf是一个基于JSON的文本文件，可以使用此VS代码扩展轻松编辑，通常引用外部文件，如纹理贴图和二进制网格数据。 .glb是二进制版本，通常较小且独立，但不易编辑。</p> <p>本人也制作和导出过多种格式的3D文件，这里主要介绍.obj和.mtl以及gltf/glb。</p> <h2 id="导入obj"><a href="#导入obj" aria-hidden="true" class="header-anchor">#</a> 导入obj</h2> <p>.obj和.mtl一般是同时导入的。如果只有.obj文件，导入到浏览器之后是可以看到模型的，但是材质和贴图消失了，下面通过具体示例讲解：</p> <p>在前面例子的基础上，我们在head标签中添加</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>js/OBJLoader.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>之后我们删除场景中的cube、sphere和plane,添加如下代码:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//加载.obj格式文件</span>
<span class="token keyword">let</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>OBJLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'../3D/obj/room.obj'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     obj<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//模型按1:1显示，设置其它参数可缩放模型</span>
     scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在浏览器中查看模型效果如下:</p> <p><img src="/assets/img/obj.d51e2f55.png" alt="obj模型"></p> <p>没有材质和贴图的模型是没有灵魂的，所以这就是.obj文件需要与.mtl文件一同使用的原因。</p> <h2 id="导入obj和mtl"><a href="#导入obj和mtl" aria-hidden="true" class="header-anchor">#</a> 导入obj和mtl</h2> <p>我们在前面的例子的基础上，再引入MTLLoader.js文件：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>js/OBJLoader.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>js/MTLLoader.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>之后我们将加载.obj格式文件的删除，添加如下代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//加载.obj和.mtl格式文件</span>
<span class="token keyword">let</span> mtlLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MTLLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mtlLoader<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">'../3D/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  mtlLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'room.mtl'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">materials</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     materials<span class="token punctuation">.</span><span class="token function">preload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">let</span> objLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>OBJLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     objLoader<span class="token punctuation">.</span><span class="token function">setMaterials</span><span class="token punctuation">(</span>materials<span class="token punctuation">)</span><span class="token punctuation">;</span>
     objLoader<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">'../3D/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     objLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'room.obj'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在浏览器中查看模型效果如下图所示，自己也可尝试下加入其它光源，使场景更加真实，另外阴影效果还没添加😂!</p> <p><img src="/assets/img/mtl.40c3a93f.png" alt="obj模型"></p> <p>本例中的模型是在3D max中制作的，导出模型时选择.obj格式并选择材质导出，然后设置下相应参数，主要参数设置如下图:
<img src="/assets/img/set.195ebdac.png" alt="obj导出"></p> <div class="warning custom-block"><p class="custom-block-title">特别提示</p> <p>为了演示和讲解方便，这里将整个模型直接导出，导出的模型接近100M,在本地加载时都有很大的延迟，更何况是部署到外网通过浏览器访问，为此，要寻找更加可能的加载方案，减少加载时间!</p></div> <h2 id="模型加载优化"><a href="#模型加载优化" aria-hidden="true" class="header-anchor">#</a> 模型加载优化</h2> <p>实践经验总结：</p> <ol><li>将大模型分解成多个小模型，较小的模型先显示出来，大模型最后显示；</li> <li>模型压缩，模型实际上是由网格组成的，网格越多，模型就越大，在不影响主体显示效果的前提下，可以减少模型的面数来获得较小的模型；</li> <li>模型复用，就上面的例子来说，13把椅子实际上是同一个模型，单独保存一个椅子模型，for循环一下，调整下位置就ok了。</li></ol> <h2 id="加载gltf-glb模型"><a href="#加载gltf-glb模型" aria-hidden="true" class="header-anchor">#</a> 加载gltf/glb模型</h2> <p>鉴于上面问题和对应的解决方案，我们接下来尝试将大模型分解成多个gltf/glb小模型，并去除不必要的模型。</p> <p>这次我们在head标签中添加的是：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>js/GLTFLoader.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>修改模型加载的代码:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//加载gltf/glb格式文件</span>
 <span class="token keyword">let</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>GLTFLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">function</span> <span class="token function">loadModel</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span> <span class="token string">'../3D/'</span><span class="token operator">+</span>name<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span> <span class="token parameter">obj</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> obj<span class="token punctuation">.</span>scene <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
 <span class="token function">loadModel</span><span class="token punctuation">(</span><span class="token string">'wall.glb'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">loadModel</span><span class="token punctuation">(</span><span class="token string">'door.glb'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">loadModel</span><span class="token punctuation">(</span><span class="token string">'asset.glb'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">loadModel</span><span class="token punctuation">(</span><span class="token string">'closet.gltf'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">loadModel</span><span class="token punctuation">(</span><span class="token string">'chair.gltf'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这次的加载速度非常快，加载到浏览器中的效果如下:</p> <p><img src="/assets/img/gltf.daa2429b.png" alt="gltf模型">;</p> <div class="tip custom-block"><p class="custom-block-title">提示</p> <p>这里只加载了一把椅子，剩下的12把，自己尝试for循环添加一下</p></div> <h2 id="skybox"><a href="#skybox" aria-hidden="true" class="header-anchor">#</a> skybox</h2> <p>前面介绍过天空盒用来给场景添加背景，使得模型始终在这个场景中，天空盒实际上是由6张图片组成的：</p> <p><img src="/assets/img/skybox.5ebfdb3d.png" alt="skybox模型"></p> <p>在three.js中添加天空盒非常的简单,添加如下代码:</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token comment">//天空盒</span>
 <span class="token keyword">function</span> <span class="token function">initScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    scene<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>CubeTextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	   <span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span> <span class="token string">'../skybox/'</span> <span class="token punctuation">)</span>
	   <span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span> <span class="token punctuation">[</span> <span class="token string">'posx.jpg'</span><span class="token punctuation">,</span> <span class="token string">'negx.jpg'</span><span class="token punctuation">,</span> <span class="token string">'posy.jpg'</span><span class="token punctuation">,</span> <span class="token string">'negy.jpg'</span><span class="token punctuation">,</span> <span class="token string">'posz.jpg'</span><span class="token punctuation">,</span> <span class="token string">'negz.jpg'</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 <span class="token function">initScene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在浏览器中预览效果如下:</p> <p><img src="/assets/img/sky.356138d8.png" alt="skybox模型">;</p> <h2 id="场景优化"><a href="#场景优化" aria-hidden="true" class="header-anchor">#</a> 场景优化</h2> <p>细心的朋友们可能发现了一些小bug,比如下图，椅子的靠背和扶手的面消失了😂</p> <p><img src="/assets/img/err.e0894add.png" alt="椅子错误">;</p> <p>这是由于模型在设置渲染的单面，将其渲染成双面就好了，这个设置与阴影的设置在一个地方，那么我们也一起设置好了。
修改模型加载的代码为:</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token comment">//加载gltf/glb格式文件</span>
  <span class="token keyword">let</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>GLTFLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">loadModel</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    loader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span> <span class="token string">'../3D/'</span><span class="token operator">+</span>name<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span> <span class="token parameter">obj</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span> obj<span class="token punctuation">.</span>scene <span class="token punctuation">)</span><span class="token punctuation">;</span>
      obj<span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>object<span class="token punctuation">.</span>isMesh<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            object<span class="token punctuation">.</span>material<span class="token punctuation">.</span>side <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>DoubleSide<span class="token punctuation">;</span>
            object<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            object<span class="token punctuation">.</span>receiveShadow <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">loadModel</span><span class="token punctuation">(</span><span class="token string">'wall.glb'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">loadModel</span><span class="token punctuation">(</span><span class="token string">'door.glb'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">loadModel</span><span class="token punctuation">(</span><span class="token string">'asset.glb'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">loadModel</span><span class="token punctuation">(</span><span class="token string">'closet.gltf'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">loadModel</span><span class="token punctuation">(</span><span class="token string">'chair.gltf'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>椅子的错误和场景的阴影效果就有了。</p> <p><img src="/assets/img/god.b21ef0ca.png" alt="椅子改正"></p> <p>多次尝试优化模型显示效果，最后一个友好的3D 模型就呈现出来了。</p> <p><img src="/assets/img/end.119369a0.png" alt="最终效果"></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Three.js/note/five.html" class="prev">给场景添加交互</a></span> <span class="next"><a href="/Three.js/note/seven.html">Vue 项目中引入Three.js创建完整的模型场景</a>→
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f5aa86f6.js" defer></script><script src="/assets/js/2.029d9bf8.js" defer></script><script src="/assets/js/3.4c43594d.js" defer></script>
  </body>
</html>
